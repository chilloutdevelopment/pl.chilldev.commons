
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2015-11-03
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>ChillDev Commons JSON-RPC &#x2013; JSON-RPC dispatcher</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet" />
		<link href="../css/docs.css" rel="stylesheet" />
		<link href="../css/reflow-skin.css" rel="stylesheet" />

		<link href="http://yandex.st/highlightjs/7.5/styles/default.min.css" rel="stylesheet" />

		<link href="../css/lightbox.css" rel="stylesheet" />

		<link href="../css/site.css" rel="stylesheet" />
		<link href="../css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->



	</head>

	<body class="page-guide-rpc project-commons-jsonrpc" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="http://chilldev.pl"><img src="http://static.chilldev.pl/images/chilldevpl.png" alt="Chillout Development"/></a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Main <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="https://github.com/chilloutdevelopment/pl.chilldev.commons/" title="GitHub project" class="externalLink">GitHub project</a></li>
									<li ><a href="http://chilldev.pl/" title="Chillout Development" class="externalLink">Chillout Development</a></li>
									<li ><a href="http://wrzasq.pl/" title="Wrzasq.pl" class="externalLink">Wrzasq.pl</a></li>
									<li ><a href="https://www.facebook.com/chilldev" title="ChillDev @ Facebook" class="externalLink">ChillDev @ Facebook</a></li>
									<li ><a href="https://www.facebook.com/wrzasqpl" title="Wrzasq.pl @ Facebook" class="externalLink">Wrzasq.pl @ Facebook</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Parent Project <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../../index.html" title="ChillDev Commons">ChillDev Commons</a></li>
								</ul>
							</li>
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Guide <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li class="active"><a href="" title="JSON-RPC dispatcher">JSON-RPC dispatcher</a></li>
									<li ><a href="mina.html" title="Mina I/O">Mina I/O</a></li>
									<li ><a href="listener.html" title="Building listener">Building listener</a></li>
									<li ><a href="daemon.html" title="Building daemon">Building daemon</a></li>
									<li ><a href="client.html" title="Building client">Building client</a></li>
									<li ><a href="json.html" title="JSON extras">JSON extras</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li class="dropdown-submenu ">
										<a href="../project-info.html" title="Project Information">Project Information</a>
										<ul class="dropdown-menu">
											<li ><a href="../integration.html" title="Continuous Integration">Continuous Integration</a></li>
											<li ><a href="../dependencies.html" title="Dependencies">Dependencies</a></li>
											<li ><a href="../dependency-info.html" title="Dependency Information">Dependency Information</a></li>
											<li ><a href="../distribution-management.html" title="Distribution Management">Distribution Management</a></li>
											<li ><a href="../index.html" title="About">About</a></li>
											<li ><a href="../issue-tracking.html" title="Issue Tracking">Issue Tracking</a></li>
											<li ><a href="../license.html" title="Project License">Project License</a></li>
											<li ><a href="../plugin-management.html" title="Plugin Management">Plugin Management</a></li>
											<li ><a href="../plugins.html" title="Project Plugins">Project Plugins</a></li>
											<li ><a href="../team-list.html" title="Project Team">Project Team</a></li>
											<li ><a href="../source-repository.html" title="Source Repository">Source Repository</a></li>
											<li ><a href="../project-summary.html" title="Project Summary">Project Summary</a></li>
										</ul>
									</li>
									<li class="dropdown-submenu ">
										<a href="../project-reports.html" title="Project Reports">Project Reports</a>
										<ul class="dropdown-menu">
											<li ><a href="../checkstyle.html" title="Checkstyle">Checkstyle</a></li>
											<li ><a href="../dependency-analysis.html" title="Dependency Analysis">Dependency Analysis</a></li>
											<li ><a href="../apidocs/index.html" title="JavaDocs">JavaDocs</a></li>
											<li ><a href="../xref/index.html" title="Source Xref">Source Xref</a></li>
											<li ><a href="../xref-test/index.html" title="Test Source Xref">Test Source Xref</a></li>
											<li ><a href="../surefire-report.html" title="Surefire Report">Surefire Report</a></li>
											<li ><a href="../cobertura/index.html" title="Cobertura Test Coverage">Cobertura Test Coverage</a></li>
											<li ><a href="../findbugs.html" title="FindBugs">FindBugs</a></li>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	<div class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<div id="bannerLeft"><h1>ChillDev Commons</h1></div>
				</div>
				<div class="pull-right">
					<a href="http://wrzasq.pl" id="bannerRight"><h1><img src="http://static.wrzasq.pl/images/wrzasqpl.png" alt="Wrzasq.pl"/></h1></a>
				</div>
			</div>
		</div>
	</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span12">
			<div class="body-content">
<!-- -
# This file is part of the ChillDev-Commons.
#
# @license http://mit-license.org/ The MIT license
# @copyright 2015 © by Rafał Wrzeszcz - Wrzasq.pl. --> 
<div class="page-header">
 <h1>JSON-RPC dispatcher</h1>
</div> 
<p><a class="externalLink" href="http://www.jsonrpc.org/specification"><b>JSON-RPC</b></a> dispatcher is an object that handles JSON requests and dispatches them to associated method handlers - it’s like the router for you JSON-RPC server. First thing you need to do is to implement method handlers (don’t worry about <tt>YourContextType</tt> class, we will discuss that further):</p> 
<div class="source"> 
 <div class="source"> 
  <pre>import com.thetransactioncompany.jsonrpc2.JSONRPC2Error;
import com.thetransactioncompany.jsonrpc2.JSONRPC2Request;
import com.thetransactioncompany.jsonrpc2.JSONRPC2Response;

import pl.chilldev.commons.jsonrpc.rpc.Dispatcher;

public class CreateUserHandler
    implements
        Dispatcher.RequestHandler&lt;YourContextType&gt;
{
    @Override
    public JSONRPC2Response process(JSONRPC2Request request, YourContextType context)
        throws
            JSONRPC2Error
    {
        try {
            // handle request

            // return valid response
            // true is your response data, can be anything
            return new JSONRPC2Response(true, request.getId());
        } catch (SomeException error) {
            return new JSONRPC2Error(errorCode, error.getMessage());
        }
    }
}
</pre> 
 </div> 
</div> 
<p>All you need to do is to register request handlers for particular method names:</p> 
<div class="source"> 
 <div class="source"> 
  <pre>import pl.chilldev.commons.jsonrpc.rpc.Dispatcher;

public class DispatcherFactory
{
    public Dispatcher&lt;YourContextType&gt; createDispatcher()
    {
        Dispatcher&lt;YourContextType&gt; dispatcher = new Dispatcher&lt;&gt;();
        dispatcher.register(&quot;createUser&quot;, new CreateUserHandler());
        // you can register more method handlers
        return dispatcher;
    }
}
</pre> 
 </div> 
</div> 
<p>That’s all you need to do with the dispatcher object. It’s usage is quite simple - it just handles the request object by mapping it’s request method to registred handlers but it’s done internally.</p> 
<div class="section"> 
 <h2 id="Method_wrappers">Method wrappers</h2> 
 <p>But yet, ususally you don’t need such low-level respnse control - response ID must always match current request ID and returned value is usually simply your method call result. So most likely generating response from based on your method call is a straight-forward task and there is not reason why you should need to handle it manually every time. For that there are two interfaces with dedicated request handlers - one for methods that generate response result (<tt>pl.chilldev.commons.jsonrpc.rpc.ReturningMethod</tt>) and one for void methods (<tt>pl.chilldev.commons.jsonrpc.rpc.VoidMethod</tt>).</p> 
 <p><b>Note:</b> If you want to return <tt>NULL</tt> value it’s a return value so you should use returning method interface - void-method indicated no response result at all (JSON-RPC response has no <tt>result</tt> property in such case).</p> 
 <p>These two interfaces are automatically wrapped by dispatcher, so you can still build your dispatcher with just your method objects:</p> 
 <div class="source"> 
  <div class="source"> 
   <pre>import com.thetransactioncompany.jsonrpc2.JSONRPC2Error;
import com.thetransactioncompany.jsonrpc2.JSONRPC2Request;
import com.thetransactioncompany.jsonrpc2.JSONRPC2Response;

import pl.chilldev.commons.jsonrpc.rpc.Dispatcher;
import pl.chilldev.commons.jsonrpc.rpc.ReturningMethod;
import pl.chilldev.commons.jsonrpc.rpc.VoidMethod;

public class DispatcherFactory
{
    public Dispatcher&lt;YourContextType&gt; createDispatcher()
    {
        Dispatcher&lt;YourContextType&gt; dispatcher = new Dispatcher&lt;&gt;();
        dispatcher.register(&quot;rawRpcHandler&quot;, new PlainCreateUserHandler());
        dispatcher.register(&quot;returningMethodName&quot;, new MyReturningMethod());
        dispatcher.register(&quot;voidMethodName&quot;, new MyVoidMethod());
        // you can register more method handlers
        return dispatcher;
    }
}

class MyReturningMethod
    implements
        ReturningMethod&lt;YourContextType&gt;
{
    @Override
    public Object process(JSONRPC2Request request, YourContextType context)
        throws
            JSONRPC2Error
    {
        try {
            // handle request

            // return valid response
            // this is your response data
            // can be anything, returning type enforced by interface is just `java.lang.Object`
            // it will be used directly as response result
            &quot;Hell world&quot;;
        } catch (SomeException error) {
            return new JSONRPC2Error(errorCode, error.getMessage());
        }
    }
}

class MyVoidMethod
    implements
        VoidMethod&lt;YourContextType&gt;
{
    @Override
    public void process(JSONRPC2Request request, YourContextType context)
        throws
            JSONRPC2Error
    {
        try {
            // handle request
            // just don't return anything
            // response will be generated with no result automatically
        } catch (SomeException error) {
            return new JSONRPC2Error(errorCode, error.getMessage());
        }
    }
}
</pre> 
  </div> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Error_codes">Error codes</h2> 
 <p>Additionally, to unify some aspects of errors handling <tt>pl.chilldev.commons.jsonrpc.rpc.ErrorCodes</tt> class provides standard error codes:</p> 
 <table border="0" class="bodyTable table table-striped table-hover"> 
  <thead> 
   <tr class="a"> 
    <th>Error code </th> 
    <th>Error code </th> 
    <th>Exception property </th> 
    <th>Scenario</th> 
   </tr> 
  </thead> 
  <tbody> 
   <tr class="b"> 
    <td><tt>-1</tt> </td> 
    <td><tt>CODE_CONNECTION</tt> </td> 
    <td><tt>ERROR_CONNECTION</tt> </td> 
    <td>This error is returned in case of connection error while waiting for the response. It’s in fact not returned by the server, but rendered internally to unify error handling strategy against network protocol.</td> 
   </tr> 
  </tbody> 
 </table> 
</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Main</li>
						<li >
							<a href="https://github.com/chilloutdevelopment/pl.chilldev.commons/" title="GitHub project" class="externalLink">GitHub project</a>
						</li>
						<li >
							<a href="http://chilldev.pl/" title="Chillout Development" class="externalLink">Chillout Development</a>
						</li>
						<li >
							<a href="http://wrzasq.pl/" title="Wrzasq.pl" class="externalLink">Wrzasq.pl</a>
						</li>
						<li >
							<a href="https://www.facebook.com/chilldev" title="ChillDev @ Facebook" class="externalLink">ChillDev @ Facebook</a>
						</li>
						<li >
							<a href="https://www.facebook.com/wrzasqpl" title="Wrzasq.pl @ Facebook" class="externalLink">Wrzasq.pl @ Facebook</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Parent Project</li>
						<li >
							<a href="../../index.html" title="ChillDev Commons">ChillDev Commons</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Guide</li>
						<li class="active">
							<a href="#" title="JSON-RPC dispatcher">JSON-RPC dispatcher</a>
						</li>
						<li >
							<a href="mina.html" title="Mina I/O">Mina I/O</a>
						</li>
						<li >
							<a href="listener.html" title="Building listener">Building listener</a>
						</li>
						<li >
							<a href="daemon.html" title="Building daemon">Building daemon</a>
						</li>
						<li >
							<a href="client.html" title="Building client">Building client</a>
						</li>
						<li >
							<a href="json.html" title="JSON extras">JSON extras</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Project Documentation</li>
						<li >
							<a href="../project-info.html" title="Project Information">Project Information <i class="icon-chevron-right"></i></a>
						</li>
						<li >
							<a href="../project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2015 <a href="http://wrzasq.pl/">Rafał Wrzeszcz - Wrzasq.pl</a>. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 0.1.0. </span><span class="publishDate">Last Published: 2015-11-03. </span></p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="../js/lightbox.min.js"></script>
	<script src="../js/reflow-scroll.js"></script>
	<script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>

	<script src="../js/reflow-skin.js"></script>

	</body>
</html>
