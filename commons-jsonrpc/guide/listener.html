
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2015-12-18
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>ChillDev Commons JSON-RPC &#x2013; Listener</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet" />
		<link href="../css/docs.css" rel="stylesheet" />
		<link href="../css/reflow-skin.css" rel="stylesheet" />

		<link href="http://yandex.st/highlightjs/7.5/styles/default.min.css" rel="stylesheet" />

		<link href="../css/lightbox.css" rel="stylesheet" />

		<link href="../css/site.css" rel="stylesheet" />
		<link href="../css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->



	</head>

	<body class="page-guide-listener project-commons-jsonrpc" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="http://chilldev.pl"><img src="http://static.chilldev.pl/images/chilldevpl.png" alt="Chillout Development"/></a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Main <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="https://github.com/chilloutdevelopment/pl.chilldev.commons/" title="GitHub project" class="externalLink">GitHub project</a></li>
									<li ><a href="http://chilldev.pl/" title="Chillout Development" class="externalLink">Chillout Development</a></li>
									<li ><a href="http://wrzasq.pl/" title="Wrzasq.pl" class="externalLink">Wrzasq.pl</a></li>
									<li ><a href="https://www.facebook.com/chilldev" title="ChillDev @ Facebook" class="externalLink">ChillDev @ Facebook</a></li>
									<li ><a href="https://www.facebook.com/wrzasqpl" title="Wrzasq.pl @ Facebook" class="externalLink">Wrzasq.pl @ Facebook</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Parent Project <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../../index.html" title="ChillDev Commons">ChillDev Commons</a></li>
								</ul>
							</li>
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Guide <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="rpc.html" title="JSON-RPC - dispatcher">JSON-RPC - dispatcher</a></li>
									<li ><a href="introspector.html" title="JSON-RPC - introspector">JSON-RPC - introspector</a></li>
									<li ><a href="mina.html" title="Mina I/O">Mina I/O</a></li>
									<li class="active"><a href="" title="Building listener">Building listener</a></li>
									<li ><a href="daemon.html" title="Building daemon">Building daemon</a></li>
									<li ><a href="client.html" title="Building client">Building client</a></li>
									<li ><a href="json.html" title="JSON extras">JSON extras</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li class="dropdown-submenu ">
										<a href="../project-info.html" title="Project Information">Project Information</a>
										<ul class="dropdown-menu">
											<li ><a href="../integration.html" title="Continuous Integration">Continuous Integration</a></li>
											<li ><a href="../dependencies.html" title="Dependencies">Dependencies</a></li>
											<li ><a href="../dependency-info.html" title="Dependency Information">Dependency Information</a></li>
											<li ><a href="../distribution-management.html" title="Distribution Management">Distribution Management</a></li>
											<li ><a href="../index.html" title="About">About</a></li>
											<li ><a href="../issue-tracking.html" title="Issue Tracking">Issue Tracking</a></li>
											<li ><a href="../license.html" title="Project License">Project License</a></li>
											<li ><a href="../plugin-management.html" title="Plugin Management">Plugin Management</a></li>
											<li ><a href="../plugins.html" title="Project Plugins">Project Plugins</a></li>
											<li ><a href="../team-list.html" title="Project Team">Project Team</a></li>
											<li ><a href="../source-repository.html" title="Source Repository">Source Repository</a></li>
											<li ><a href="../project-summary.html" title="Project Summary">Project Summary</a></li>
										</ul>
									</li>
									<li class="dropdown-submenu ">
										<a href="../project-reports.html" title="Project Reports">Project Reports</a>
										<ul class="dropdown-menu">
											<li ><a href="../checkstyle.html" title="Checkstyle">Checkstyle</a></li>
											<li ><a href="../dependency-analysis.html" title="Dependency Analysis">Dependency Analysis</a></li>
											<li ><a href="../apidocs/index.html" title="JavaDocs">JavaDocs</a></li>
											<li ><a href="../xref/index.html" title="Source Xref">Source Xref</a></li>
											<li ><a href="../surefire-report.html" title="Surefire Report">Surefire Report</a></li>
											<li ><a href="../findbugs.html" title="FindBugs">FindBugs</a></li>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	<div class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<div id="bannerLeft"><h1>ChillDev Commons</h1></div>
				</div>
				<div class="pull-right">
					<a href="http://wrzasq.pl" id="bannerRight"><h1><img src="http://static.wrzasq.pl/images/wrzasqpl.png" alt="Wrzasq.pl"/></h1></a>
				</div>
			</div>
		</div>
	</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span12">
			<div class="body-content">
<!-- -
# This file is part of the ChillDev-Commons.
#
# @license http://mit-license.org/ The MIT license
# @copyright 2015 © by Rafał Wrzeszcz - Wrzasq.pl. --> 
<div class="page-header">
 <h1>Listener</h1>
</div> 
<p>If you just want to build own, stand-alone <b>JSON-RPC</b> daemon, <tt>pl.chilldev.commons.jsonrpc.daemon.Listener</tt> is all you need to bind your dispatcher to listen on the network address. Listener is a thread that is specified to listen for ongoing connection on given port and react on them. All you need to do is to start the thread with specified address to listen on:</p> 
<div class="source"> 
 <div class="source"> 
  <pre>import java.net.InetSocketAddress;

import pl.chilldev.commons.jsonrpc.daemon.Listener;

public class App
{
    public static void main(String[] args)
    {
        Listener&lt;YourContextType&gt; listener = new Listener&lt;&gt;(&quot;threadName&quot;, yourContext, yourDispatcher);
        listener.setAddress(new InetSocketAddress(&quot;localhost&quot;, 1234));
        listener.start();

        // do your stuff

        // this tells listener to stop the server
        listener.release();
        // listener is just a java.lang.Thread instance, use standard Java API to wait for thread end
        listener.join();
    }
}
</pre> 
 </div> 
</div> 
<p>You can tune server settings with:</p> 
<ul> 
 <li><tt>Listener.setSleepTick(int sleepTick)</tt> - to change sleep interval for release checks (defaults to <b>0.5s</b>);</li> 
 <li><tt>Listener.setMaxPacketSize(int maxPacketSize)</tt> - to change maximum JSON-RPC packet size (defaults to <b>32MiB</b>).</li> 
</ul> 
<div class="section"> 
 <h2 id="Execution_context">Execution context</h2> 
 <p>Ok, what’s with this <tt>YourContextType</tt> class, finally? This is the execution context that will be passed to all RPC request handlers. This allows you to build service-agnostic request handlers and dispatchers - you can build universal service with multiple listeners running with same <b>JSON-RPC</b> dispatcher (and thus same request handlers) on different sockets. For example run same JSON-RPC service on shared server with different execution context for each project.</p> 
 <p>Context is bound to <tt>DispatcherIoHandler</tt> instance (<tt>Listener</tt> builds own <tt>DispatcherIoHandler</tt> internally), not to the <tt>Dispatcher</tt> one, so the dispatcher (together with request handlers) can simply operate on resources of each contexts separately.</p> 
 <p>Your context need to implement interface <tt>pl.chilldev.commons.jsonrpc.daemon.ContextInterface</tt> (for now it’s empty interface, just used as a marker):</p> 
 <div class="source"> 
  <div class="source"> 
   <pre>import pl.chilldev.commons.jsonrpc.daemon.ContextInterface;

public class YourContextType implements ContextInterface
{
    // provide any resources you need to expose in method handlers
}
</pre> 
  </div> 
 </div> 
 <p>You can then create separate contexts for each listener that use the dispatcher.</p> 
 <div class="source"> 
  <div class="source"> 
   <pre>Dispatcher&lt;YourContextType&gt; dispatcher = new Dispatcher&lt;&gt;();
dispatcher.register(&quot;createUser&quot;, new Dispatcher.RequestHandler&lt;YourContextType&gt;() {
    public JSONRPC2Response process(JSONRPC2Request request, YourContextType context)
        throws
            JSONRPC2Error
    {
        // context depends on the fact from which Listener this method was called
    }
});

YourContextType context1 = new YourContextType();
// set context1 for projectFoo

YourContextType context2 = new YourContextType();
// set context2 for projectBar

YourContextType context3 = new YourContextType();
// set context3 for projectBaz

// note that we use same dispatcher object everywhere, you may be sure that all services will expose same API
Listener&lt;YourContextType&gt; listener1 = new Listener&lt;&gt;(&quot;rpc-wrzasq.pl&quot;, context1, dispatcher);
Listener&lt;YourContextType&gt; listener2 = new Listener&lt;&gt;(&quot;rpc-chilldev.pl&quot;, context2, dispatcher);
Listener&lt;YourContextType&gt; listener3 = new Listener&lt;&gt;(&quot;rpc-ikancelaria.com&quot;, context3, dispatcher);
</pre> 
  </div> 
 </div> 
</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Main</li>
						<li >
							<a href="https://github.com/chilloutdevelopment/pl.chilldev.commons/" title="GitHub project" class="externalLink">GitHub project</a>
						</li>
						<li >
							<a href="http://chilldev.pl/" title="Chillout Development" class="externalLink">Chillout Development</a>
						</li>
						<li >
							<a href="http://wrzasq.pl/" title="Wrzasq.pl" class="externalLink">Wrzasq.pl</a>
						</li>
						<li >
							<a href="https://www.facebook.com/chilldev" title="ChillDev @ Facebook" class="externalLink">ChillDev @ Facebook</a>
						</li>
						<li >
							<a href="https://www.facebook.com/wrzasqpl" title="Wrzasq.pl @ Facebook" class="externalLink">Wrzasq.pl @ Facebook</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Parent Project</li>
						<li >
							<a href="../../index.html" title="ChillDev Commons">ChillDev Commons</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Guide</li>
						<li >
							<a href="rpc.html" title="JSON-RPC - dispatcher">JSON-RPC - dispatcher</a>
						</li>
						<li >
							<a href="introspector.html" title="JSON-RPC - introspector">JSON-RPC - introspector</a>
						</li>
						<li >
							<a href="mina.html" title="Mina I/O">Mina I/O</a>
						</li>
						<li class="active">
							<a href="#" title="Building listener">Building listener</a>
						</li>
						<li >
							<a href="daemon.html" title="Building daemon">Building daemon</a>
						</li>
						<li >
							<a href="client.html" title="Building client">Building client</a>
						</li>
						<li >
							<a href="json.html" title="JSON extras">JSON extras</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Project Documentation</li>
						<li >
							<a href="../project-info.html" title="Project Information">Project Information <i class="icon-chevron-right"></i></a>
						</li>
						<li >
							<a href="../project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2015 <a href="http://wrzasq.pl/">Rafał Wrzeszcz - Wrzasq.pl</a>. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 0.1.1. </span><span class="publishDate">Last Published: 2015-12-18. </span></p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="../js/lightbox.min.js"></script>
	<script src="../js/reflow-scroll.js"></script>
	<script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>

	<script src="../js/reflow-skin.js"></script>

	</body>
</html>
