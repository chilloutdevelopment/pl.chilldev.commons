<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.1 at 2016-08-27 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20160827" />
    <meta http-equiv="Content-Language" content="en" />
    <title>ChillDev Commons JSON-RPC &#x2013; Listener</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.5.min.js"></script>

                      </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>ChillDev Commons JSON-RPC</h2>
                </div>
                      </div>
        <div class="pull-right">                  <a href="http://wrzasq.pl" id="bannerRight">
                <h2><img src="http://static.wrzasq.pl/images/wrzasqpl.png" alt="Wrzasq.pl"/></h2>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
            
              
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Main</li>
                              
      <li>
  
                          <a href="https://github.com/chilloutdevelopment/pl.chilldev.commons/" class="externalLink" title="GitHub project">
          <span class="none"></span>
        GitHub project</a>
            </li>
                
      <li>
  
                          <a href="http://chilldev.pl/" class="externalLink" title="Chillout Development">
          <span class="none"></span>
        Chillout Development</a>
            </li>
                
      <li>
  
                          <a href="http://wrzasq.pl/" class="externalLink" title="Wrzasq.pl">
          <span class="none"></span>
        Wrzasq.pl</a>
            </li>
                
      <li>
  
                          <a href="https://www.facebook.com/chilldev" class="externalLink" title="ChillDev @ Facebook">
          <span class="none"></span>
        ChillDev @ Facebook</a>
            </li>
                
      <li>
  
                          <a href="https://www.facebook.com/wrzasqpl" class="externalLink" title="Wrzasq.pl @ Facebook">
          <span class="none"></span>
        Wrzasq.pl @ Facebook</a>
            </li>
                              <li class="nav-header">Parent Project</li>
                              
      <li>
  
                          <a href="../../index.html" title="ChillDev Commons">
          <span class="none"></span>
        ChillDev Commons</a>
            </li>
                              <li class="nav-header">Guide</li>
                              
      <li>
  
                          <a href="../guide/rpc.html" title="JSON-RPC - dispatcher">
          <span class="none"></span>
        JSON-RPC - dispatcher</a>
            </li>
                
      <li>
  
                          <a href="../guide/introspector.html" title="JSON-RPC - introspector">
          <span class="none"></span>
        JSON-RPC - introspector</a>
            </li>
                
      <li>
  
                          <a href="../guide/netty.html" title="Netty I/O">
          <span class="none"></span>
        Netty I/O</a>
            </li>
                
      <li class="active">
  
            <a href="#"><span class="none"></span>Building listener</a>
          </li>
                
      <li>
  
                          <a href="../guide/daemon.html" title="Building daemon">
          <span class="none"></span>
        Building daemon</a>
            </li>
                
      <li>
  
                          <a href="../guide/client.html" title="Building client">
          <span class="none"></span>
        Building client</a>
            </li>
                
      <li>
  
                          <a href="../guide/json.html" title="JSON extras">
          <span class="none"></span>
        JSON extras</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                      
      <li>
  
                          <a href="../project-info.html" title="Project Information">
          <span class="icon-chevron-right"></span>
        Project Information</a>
                  </li>
                                                                                                                                                                                                
      <li>
  
                          <a href="../project-reports.html" title="Project Reports">
          <span class="icon-chevron-right"></span>
        Project Reports</a>
                  </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                   <a href="http://maven.apache.org/" title="Maven" class="builtBy">
        <img class="builtBy"  alt="Apache Maven" src="http://maven.apache.org/images/logos/maven-feather.png"    />
      </a>
                                                                                                    <a href="http://chilldev.pl" title="Chillout Development" class="builtBy">
        <img class="builtBy"  alt="Chillout Development" src="http://static.chilldev.pl/images/chilldevpl.png"    />
      </a>
                                                                                                    <a href="http://wrzasq.pl" title="Wrzasq.pl" class="builtBy">
        <img class="builtBy"  alt="Wrzasq.pl" src="http://static.chilldev.pl/images/wrzasqpl.png"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <!---
# This file is part of the ChillDev-Commons.
#
# @license http://mit-license.org/ The MIT license
# @copyright 2015 - 2016 © by Rafał Wrzeszcz - Wrzasq.pl.
--><h1>Listener</h1>
<p>If you just want to build own, stand-alone <b>JSON-RPC</b> daemon, <tt>pl.chilldev.commons.jsonrpc.daemon.Listener</tt> is all you need to bind your dispatcher to listen on the network address. Listener is specified to listen for ongoing connection on given port and react on them. All you need to do is to start it with specified address to listen on:</p>

<div class="source">
<div class="source"><pre class="prettyprint">import java.net.InetSocketAddress;

import pl.chilldev.commons.jsonrpc.daemon.Listener;

public class App
{
    public static void main(String[] args)
    {
        Listener&lt;YourContextType&gt; listener = new Listener&lt;&gt;(&quot;listenerName&quot;, yourContext, yourDispatcher);
        listener.setAddress(new InetSocketAddress(&quot;localhost&quot;, 1234));
        listener.start();

        // do your stuff

        // this tells listener to stop the server
        listener.stop();
    }
}
</pre></div></div>
<p>You can tune server settings with:</p>

<ul>
  
<li><tt>Listener.setMaxPacketSize(int maxPacketSize)</tt> - to change maximum JSON-RPC packet size (defaults to <b>32MiB</b>).</li>
</ul>
<div class="section">
<h2><a name="Execution_context"></a>Execution context</h2>
<p>Ok, what&#x2019;s with this <tt>YourContextType</tt> class, finally? This is the execution context that will be passed to all RPC request handlers. This allows you to build service-agnostic request handlers and dispatchers - you can build universal service with multiple listeners running with same <b>JSON-RPC</b> dispatcher (and thus same request handlers) on different sockets. For example run same JSON-RPC service on shared server with different execution context for each project.</p>
<p>Context is bound to <tt>DispatcherHandler</tt> instance (<tt>Listener</tt> builds own <tt>DispatcherHandler</tt> internally), not to the <tt>Dispatcher</tt> one, so the dispatcher (together with request handlers) can simply operate on resources of each of contexts separately.</p>
<p>Your context need to implement interface <tt>pl.chilldev.commons.jsonrpc.daemon.ContextInterface</tt> (for now it&#x2019;s empty interface, just used as a marker):</p>

<div class="source">
<div class="source"><pre class="prettyprint">import pl.chilldev.commons.jsonrpc.daemon.ContextInterface;

public class YourContextType implements ContextInterface
{
    // provide any resources you need to expose in method handlers
}
</pre></div></div>
<p>You can then create separate contexts for each listener that use the dispatcher.</p>

<div class="source">
<div class="source"><pre class="prettyprint">Dispatcher&lt;YourContextType&gt; dispatcher = new Dispatcher&lt;&gt;();
dispatcher.register(&quot;createUser&quot;, new Dispatcher.RequestHandler&lt;YourContextType&gt;() {
    public JSONRPC2Response process(JSONRPC2Request request, YourContextType context)
        throws
            JSONRPC2Error
    {
        // context depends on the fact from which Listener this method was called
    }
});

YourContextType context1 = new YourContextType();
// set context1 for projectFoo

YourContextType context2 = new YourContextType();
// set context2 for projectBar

YourContextType context3 = new YourContextType();
// set context3 for projectBaz

// note that we use same dispatcher object everywhere, you may be sure that all services will expose same API
Listener&lt;YourContextType&gt; listener1 = new Listener&lt;&gt;(&quot;rpc-wrzasq.pl&quot;, context1, dispatcher);
Listener&lt;YourContextType&gt; listener2 = new Listener&lt;&gt;(&quot;rpc-chilldev.pl&quot;, context2, dispatcher);
Listener&lt;YourContextType&gt; listener3 = new Listener&lt;&gt;(&quot;rpc-ikancelaria.com&quot;, context3, dispatcher);
</pre></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                    2015&#x2013;2016
                        <a href="http://wrzasq.pl/">Rafał Wrzeszcz - Wrzasq.pl</a>.
            All rights reserved.    
                  <li id="publishDate" class="pull-right">Last Published: 2016-08-27</li>
              <li id="projectVersion" class="pull-right">
                    Version: 0.1.2
        </li>
            </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
