
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2015-12-18
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>ChillDev Commons JSON-RPC &#x2013; Daemon application</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet" />
		<link href="../css/docs.css" rel="stylesheet" />
		<link href="../css/reflow-skin.css" rel="stylesheet" />

		<link href="http://yandex.st/highlightjs/7.5/styles/default.min.css" rel="stylesheet" />

		<link href="../css/lightbox.css" rel="stylesheet" />

		<link href="../css/site.css" rel="stylesheet" />
		<link href="../css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->



	</head>

	<body class="page-guide-daemon project-commons-jsonrpc" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="http://chilldev.pl"><img src="http://static.chilldev.pl/images/chilldevpl.png" alt="Chillout Development"/></a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Main <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="https://github.com/chilloutdevelopment/pl.chilldev.commons/" title="GitHub project" class="externalLink">GitHub project</a></li>
									<li ><a href="http://chilldev.pl/" title="Chillout Development" class="externalLink">Chillout Development</a></li>
									<li ><a href="http://wrzasq.pl/" title="Wrzasq.pl" class="externalLink">Wrzasq.pl</a></li>
									<li ><a href="https://www.facebook.com/chilldev" title="ChillDev @ Facebook" class="externalLink">ChillDev @ Facebook</a></li>
									<li ><a href="https://www.facebook.com/wrzasqpl" title="Wrzasq.pl @ Facebook" class="externalLink">Wrzasq.pl @ Facebook</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Parent Project <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../../index.html" title="ChillDev Commons">ChillDev Commons</a></li>
								</ul>
							</li>
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Guide <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="rpc.html" title="JSON-RPC - dispatcher">JSON-RPC - dispatcher</a></li>
									<li ><a href="introspector.html" title="JSON-RPC - introspector">JSON-RPC - introspector</a></li>
									<li ><a href="mina.html" title="Mina I/O">Mina I/O</a></li>
									<li ><a href="listener.html" title="Building listener">Building listener</a></li>
									<li class="active"><a href="" title="Building daemon">Building daemon</a></li>
									<li ><a href="client.html" title="Building client">Building client</a></li>
									<li ><a href="json.html" title="JSON extras">JSON extras</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li class="dropdown-submenu ">
										<a href="../project-info.html" title="Project Information">Project Information</a>
										<ul class="dropdown-menu">
											<li ><a href="../integration.html" title="Continuous Integration">Continuous Integration</a></li>
											<li ><a href="../dependencies.html" title="Dependencies">Dependencies</a></li>
											<li ><a href="../dependency-info.html" title="Dependency Information">Dependency Information</a></li>
											<li ><a href="../distribution-management.html" title="Distribution Management">Distribution Management</a></li>
											<li ><a href="../index.html" title="About">About</a></li>
											<li ><a href="../issue-tracking.html" title="Issue Tracking">Issue Tracking</a></li>
											<li ><a href="../license.html" title="Project License">Project License</a></li>
											<li ><a href="../plugin-management.html" title="Plugin Management">Plugin Management</a></li>
											<li ><a href="../plugins.html" title="Project Plugins">Project Plugins</a></li>
											<li ><a href="../team-list.html" title="Project Team">Project Team</a></li>
											<li ><a href="../source-repository.html" title="Source Repository">Source Repository</a></li>
											<li ><a href="../project-summary.html" title="Project Summary">Project Summary</a></li>
										</ul>
									</li>
									<li class="dropdown-submenu ">
										<a href="../project-reports.html" title="Project Reports">Project Reports</a>
										<ul class="dropdown-menu">
											<li ><a href="../checkstyle.html" title="Checkstyle">Checkstyle</a></li>
											<li ><a href="../dependency-analysis.html" title="Dependency Analysis">Dependency Analysis</a></li>
											<li ><a href="../apidocs/index.html" title="JavaDocs">JavaDocs</a></li>
											<li ><a href="../xref/index.html" title="Source Xref">Source Xref</a></li>
											<li ><a href="../surefire-report.html" title="Surefire Report">Surefire Report</a></li>
											<li ><a href="../findbugs.html" title="FindBugs">FindBugs</a></li>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	<div class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<div id="bannerLeft"><h1>ChillDev Commons</h1></div>
				</div>
				<div class="pull-right">
					<a href="http://wrzasq.pl" id="bannerRight"><h1><img src="http://static.wrzasq.pl/images/wrzasqpl.png" alt="Wrzasq.pl"/></h1></a>
				</div>
			</div>
		</div>
	</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span12">
			<div class="body-content">
<!-- -
# This file is part of the ChillDev-Commons.
#
# @license http://mit-license.org/ The MIT license
# @copyright 2015 © by Rafał Wrzeszcz - Wrzasq.pl. --> 
<div class="page-header">
 <h1>Daemon application</h1>
</div> 
<p>Once you have a <a href="./listener.html">listener</a> implemented you can use it in your application. But for simple RPC services listener, dispatcher and request handlers is all that you need. It would require a lot of bloat-code to expose the run just a listener thread and manage it. <a class="externalLink" href="http://commons.apache.org/proper/commons-daemon/"><b>Apache Commons Daemon</b></a> is a simple library that allows you to write simple daemon applications in <b>Java</b>. What’s more, <tt>pl.chilldev.commons:commons-jsonrpc</tt> package comes with partially-implemented abstract classes that even simplifies the task by assuming that all you need to do is to manage listener threads.</p> 
<p>Daemon application, by default (you can simply override any of the daemon method) behavies like this:</p> 
<ul> 
 <li>starting the daemon starts all the listener threads;</li> 
 <li>stopping the daemon stops all the listener threads (interrupts if needed);</li> 
 <li><tt>SIGUSR2</tt> handling will stop and then start again all listener threads (not much gain, but entire <b>JVM</b> bootstrapping goes away).</li> 
</ul> 
<div class="section"> 
 <div class="section"> 
  <h3 id="Maven_dependenies">Maven dependenies</h3> 
  <p>In order to use base implementation of daemon application you will have to add additional dependency to your project (to save space and time for people who don’t want to use JSON-RPC package without full application this package is marked as optional in our library <tt>pom.xml</tt>):</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>&lt;dependency&gt;
    &lt;groupId&gt;commons-daemon&lt;/groupId&gt;
    &lt;artifactId&gt;commons-daemon&lt;/artifactId&gt;
    &lt;version&gt;${apache.commons.daemon.version}&lt;/version&gt;
&lt;/dependency&gt;
</pre> 
   </div> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Implementing">Implementing</h3> 
  <p>All you have to implement in your concrete class is to implement two simple informational method and the core method that builds listeners. Additionally it may also be a good idea to implement <tt>main()</tt> method to allow direct running through CLI interface:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>import pl.chilldev.commons.jsonrpc.daemon.AbstractApplication;

/**
 * Application daemon manager.
 */
public class App extends AbstractApplication
{
    /**
     * Application entry point.
     *
     * @param args Command line arguments.
     */
    public static void main(String[] args)
    {
        App app = new App();

        try {
            // perform initialization and start daemon
            app.init(null);
            app.start();

            // schedule shutdown hook for daemon cleanup
            Runtime.getRuntime().addShutdownHook(new Shutdown(app));
        } catch (Throwable error) {
            app.logger.error(&quot;Fatal error {}.&quot;, error.getMessage(), error);
            System.exit(1);
        }
    }

    /**
     * {@inheritDoc}
     */
    @Override
    protected String getDaemonName()
    {
        return &quot;example-daemon&quot;;
    }

    /**
     * {@inheritDoc}
     */
    @Override
    protected String getDaemonVersion()
    {
        return &quot;0.0.1&quot;;
    }

    /**
     * {@inheritDoc}
     */
    @Override
    protected Collection&lt;Listener&gt; buildListeners()
    {
        // build list of listeners and return it - don't start them!
    }
}
</pre> 
   </div> 
  </div> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Spring_integration">Spring integration</h2> 
 <p>To make things even easier, if you want to use <b>Spring</b> in your application you can also use it to manage listener threads.</p> 
 <div class="section"> 
  <h3 id="Maven_dependencies">Maven dependencies</h3> 
  <p>In order to use Spring-based application class you need to add additional two dependencies (together with previous ones) to your project:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-beans&lt;/artifactId&gt;
    &lt;version&gt;${spring.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
    &lt;version&gt;${spring.version}&lt;/version&gt;
&lt;/dependency&gt;
</pre> 
   </div> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Implementing">Implementing</h3> 
  <p>When using Spring IoC container, you are expected to not set up listener threads objects on your own, but let Spring do that. Instead of <tt>buildListeners()</tt>, Spring uses <tt>getPackageToScan()</tt> method of your application to pick base package for scanning for container configuration classes. It’s recommended to keep application class in your top package as by default Spring takes the application class’ package name for scanning. In case you want to place it somewhere else or simply scan another package just override <tt>protected String getPackageToScan()</tt> method.</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>import pl.chilldev.commons.jsonrpc.daemon.AbstractSpringApplication;

/**
 * Application daemon manager.
 */
public class App extends AbstractSpringApplication
{
    /**
     * Application entry point.
     *
     * @param args Command line arguments.
     */
    public static void main(String[] args)
    {
        App app = new App();

        try {
            // perform initialization and start daemon
            app.init(null);
            app.start();

            // schedule shutdown hook for daemon cleanup
            Runtime.getRuntime().addShutdownHook(new Shutdown(app));
        } catch (Throwable error) {
            app.logger.error(&quot;Fatal error {}.&quot;, error.getMessage(), error);
            System.exit(1);
        }
    }

    /**
     * {@inheritDoc}
     */
    @Override
    protected String getDaemonName()
    {
        return &quot;your-daemon&quot;;
    }

    /**
     * {@inheritDoc}
     */
    @Override
    protected String getDaemonVersion()
    {
        return &quot;0.0.1&quot;;
    }

    // this is not needed if your package to scan is same as application class package
    /**
     * {@inheritDoc}
     */
    @Override
    protected String getPackageToScan()
    {
        return &quot;com.package.your&quot;;
    }
}
</pre> 
   </div> 
  </div> 
 </div> 
</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Main</li>
						<li >
							<a href="https://github.com/chilloutdevelopment/pl.chilldev.commons/" title="GitHub project" class="externalLink">GitHub project</a>
						</li>
						<li >
							<a href="http://chilldev.pl/" title="Chillout Development" class="externalLink">Chillout Development</a>
						</li>
						<li >
							<a href="http://wrzasq.pl/" title="Wrzasq.pl" class="externalLink">Wrzasq.pl</a>
						</li>
						<li >
							<a href="https://www.facebook.com/chilldev" title="ChillDev @ Facebook" class="externalLink">ChillDev @ Facebook</a>
						</li>
						<li >
							<a href="https://www.facebook.com/wrzasqpl" title="Wrzasq.pl @ Facebook" class="externalLink">Wrzasq.pl @ Facebook</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Parent Project</li>
						<li >
							<a href="../../index.html" title="ChillDev Commons">ChillDev Commons</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Guide</li>
						<li >
							<a href="rpc.html" title="JSON-RPC - dispatcher">JSON-RPC - dispatcher</a>
						</li>
						<li >
							<a href="introspector.html" title="JSON-RPC - introspector">JSON-RPC - introspector</a>
						</li>
						<li >
							<a href="mina.html" title="Mina I/O">Mina I/O</a>
						</li>
						<li >
							<a href="listener.html" title="Building listener">Building listener</a>
						</li>
						<li class="active">
							<a href="#" title="Building daemon">Building daemon</a>
						</li>
						<li >
							<a href="client.html" title="Building client">Building client</a>
						</li>
						<li >
							<a href="json.html" title="JSON extras">JSON extras</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Project Documentation</li>
						<li >
							<a href="../project-info.html" title="Project Information">Project Information <i class="icon-chevron-right"></i></a>
						</li>
						<li >
							<a href="../project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2015 <a href="http://wrzasq.pl/">Rafał Wrzeszcz - Wrzasq.pl</a>. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 0.1.1. </span><span class="publishDate">Last Published: 2015-12-18. </span></p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="../js/lightbox.min.js"></script>
	<script src="../js/reflow-scroll.js"></script>
	<script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>

	<script src="../js/reflow-skin.js"></script>

	</body>
</html>
