
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2015-08-11
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>ChillDev Commons JSON-RPC &#x2013; Apache MINA I/O</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet" />
		<link href="../css/docs.css" rel="stylesheet" />
		<link href="../css/reflow-skin.css" rel="stylesheet" />

		<link href="http://yandex.st/highlightjs/7.5/styles/default.min.css" rel="stylesheet" />

		<link href="../css/lightbox.css" rel="stylesheet" />

		<link href="../css/site.css" rel="stylesheet" />
		<link href="../css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->



	</head>

	<body class="page-guide-mina project-commons-jsonrpc" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="http://chilldev.pl"><img src="http://static.chilldev.pl/images/chilldevpl.png" alt="Chillout Development"/></a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Main <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="https://github.com/chilloutdevelopment/pl.chilldev.commons/" title="GitHub project" class="externalLink">GitHub project</a></li>
									<li ><a href="http://chilldev.pl/" title="Chillout Development" class="externalLink">Chillout Development</a></li>
									<li ><a href="http://wrzasq.pl/" title="Wrzasq.pl" class="externalLink">Wrzasq.pl</a></li>
									<li ><a href="https://www.facebook.com/chilldev" title="ChillDev @ Facebook" class="externalLink">ChillDev @ Facebook</a></li>
									<li ><a href="https://www.facebook.com/wrzasqpl" title="Wrzasq.pl @ Facebook" class="externalLink">Wrzasq.pl @ Facebook</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Parent Project <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../../index.html" title="ChillDev Commons">ChillDev Commons</a></li>
								</ul>
							</li>
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Guide <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="rpc.html" title="JSON-RPC dispatcher">JSON-RPC dispatcher</a></li>
									<li class="active"><a href="" title="Mina I/O">Mina I/O</a></li>
									<li ><a href="listener.html" title="Building listener">Building listener</a></li>
									<li ><a href="daemon.html" title="Building daemon">Building daemon</a></li>
									<li ><a href="client.html" title="Building client">Building client</a></li>
									<li ><a href="json.html" title="JSON extras">JSON extras</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li class="dropdown-submenu ">
										<a href="../project-info.html" title="Project Information">Project Information</a>
										<ul class="dropdown-menu">
											<li ><a href="../integration.html" title="Continuous Integration">Continuous Integration</a></li>
											<li ><a href="../dependencies.html" title="Dependencies">Dependencies</a></li>
											<li ><a href="../dependency-info.html" title="Dependency Information">Dependency Information</a></li>
											<li ><a href="../distribution-management.html" title="Distribution Management">Distribution Management</a></li>
											<li ><a href="../index.html" title="About">About</a></li>
											<li ><a href="../issue-tracking.html" title="Issue Tracking">Issue Tracking</a></li>
											<li ><a href="../license.html" title="Project License">Project License</a></li>
											<li ><a href="../plugin-management.html" title="Plugin Management">Plugin Management</a></li>
											<li ><a href="../plugins.html" title="Project Plugins">Project Plugins</a></li>
											<li ><a href="../team-list.html" title="Project Team">Project Team</a></li>
											<li ><a href="../source-repository.html" title="Source Repository">Source Repository</a></li>
											<li ><a href="../project-summary.html" title="Project Summary">Project Summary</a></li>
										</ul>
									</li>
									<li class="dropdown-submenu ">
										<a href="../project-reports.html" title="Project Reports">Project Reports</a>
										<ul class="dropdown-menu">
											<li ><a href="../checkstyle.html" title="Checkstyle">Checkstyle</a></li>
											<li ><a href="../apidocs/index.html" title="JavaDocs">JavaDocs</a></li>
											<li ><a href="../xref/index.html" title="Source Xref">Source Xref</a></li>
											<li ><a href="../xref-test/index.html" title="Test Source Xref">Test Source Xref</a></li>
											<li ><a href="../surefire-report.html" title="Surefire Report">Surefire Report</a></li>
											<li ><a href="../cobertura/index.html" title="Cobertura Test Coverage">Cobertura Test Coverage</a></li>
											<li ><a href="../findbugs.html" title="FindBugs">FindBugs</a></li>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	<div class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<div id="bannerLeft"><h1>ChillDev Commons</h1></div>
				</div>
				<div class="pull-right">
					<a href="http://wrzasq.pl" id="bannerRight"><h1><img src="http://static.wrzasq.pl/images/wrzasqpl.png" alt="Wrzasq.pl"/></h1></a>
				</div>
			</div>
		</div>
	</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span12">
			<div class="body-content">
<!-- -
# This file is part of the ChillDev-Commons.
#
# @license http://mit-license.org/ The MIT license
# @copyright 2015 © by Rafał Wrzeszcz - Wrzasq.pl. --> 
<div class="page-header">
 <h1>Apache MINA I/O</h1>
</div> 
<p><a class="externalLink" href="https://mina.apache.org"><b>Apache MINA</b></a> is perfect for building <b>JSON-RPC</b> services as it brings asynchronous network I/O stack without footprint of enclosing protocol (like <b>HTTP</b>) - you can use it to build plain <b>TCP</b> service. There are two classes that will help you bind your RPC <tt>Dispatcher</tt> with MINA socket. First is <tt>pl.chilldev.commons.jsonrpc.mina.DispatcherIoHandler</tt> which binds to MINA socket and handles requests using JSON-RPC dispatcher provided by you; second is <tt>pl.chilldev.commons.jsonrpc.mina.IoServiceUtils</tt>, which is a simple utility class that configures the socket parameters.</p> 
<div class="source"> 
 <div class="source"> 
  <pre>import org.apache.mina.transport.socket.nio.NioSocketAcceptor;

import pl.chilldev.commons.jsonrpc.mina.DispatcherIoHandler;
import pl.chilldev.commons.jsonrpc.mina.IoServiceUtils;
import pl.chilldev.commons.jsonrpc.rpc.Dispatcher;

public class NetworkService
    implements
        IoServiceUtils.Configuration
{
    @Override
    public int getMaxPacketSize()
    {
        // 1MiB
        return 1048576;
    }

    public void start(Dispatcher&lt;YourContextType&gt; dispatcher, YourContextType context)
        throws
            Exception
    {
        // this is pure MINA socket handler
        NioSocketAcceptor acceptor = new NioSocketAcceptor();

        try {
            // network service configuration
            IoServiceUtils.initialize(
                acceptor,
                // this is the most important line
                // it registers our IoHandler that will dispatch requests from MINA socket using given dispatcher
                new DispatcherIoHandler&lt;YourContextType&gt;(context, dispatcher),
                // about this argument read the next paragraph
                this
            );
            acceptor.setReuseAddress(true);
            // run the server
            acceptor.bind(this.address);

            // it should be run as a thread, the example is simplified
            while (!this.interrupted()) {
                this.sleep(this.sleepTick);
            }
        } finally {
            // close socket
            acceptor.unbind();
            acceptor.dispose();
        }
    }
}
</pre> 
 </div> 
</div> 
<p><b>Note:</b> The snippet above is the standard implementation available out of the box with <a href="./listener.html">listener</a>.</p> 
<p><b>Note:</b> <tt>DispatcherIoHandler</tt> handles all exceptions thrown during request processing (if not reported properly as error responses) and reports them as internal error to the client to avoid listener thread to die. Returned error has error code <tt>-1</tt> (see <a href="./rpc.html">error codes</a>).</p> 
<div class="section"> 
 <h2 id="IoServiceUtils.Configuration"><tt>IoServiceUtils.Configuration</tt></h2> 
 <p>The example is rather straightforward, despite some boilerplate code. But one thing may not be clear - the third parameter of <tt>IoServiceUtils.initialize()</tt>, the <tt>IoServiceUtils.Configuration</tt> interface implementation and <tt>getMaxPacketSize()</tt> method (yes, in fact it’s just one thing!). One of the parameters <tt>IoServiceUtils.initialize()</tt> method set is maximum packet size. It does that based on configuration object passed as a thord argument, which has to implement <tt>IoServiceUtils.Configuration</tt> interface. All you need to do is simply implement the <tt>getMaxPacketSize()</tt> that will return your desired packet size limit.</p> 
</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Main</li>
						<li >
							<a href="https://github.com/chilloutdevelopment/pl.chilldev.commons/" title="GitHub project" class="externalLink">GitHub project</a>
						</li>
						<li >
							<a href="http://chilldev.pl/" title="Chillout Development" class="externalLink">Chillout Development</a>
						</li>
						<li >
							<a href="http://wrzasq.pl/" title="Wrzasq.pl" class="externalLink">Wrzasq.pl</a>
						</li>
						<li >
							<a href="https://www.facebook.com/chilldev" title="ChillDev @ Facebook" class="externalLink">ChillDev @ Facebook</a>
						</li>
						<li >
							<a href="https://www.facebook.com/wrzasqpl" title="Wrzasq.pl @ Facebook" class="externalLink">Wrzasq.pl @ Facebook</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Parent Project</li>
						<li >
							<a href="../../index.html" title="ChillDev Commons">ChillDev Commons</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Guide</li>
						<li >
							<a href="rpc.html" title="JSON-RPC dispatcher">JSON-RPC dispatcher</a>
						</li>
						<li class="active">
							<a href="#" title="Mina I/O">Mina I/O</a>
						</li>
						<li >
							<a href="listener.html" title="Building listener">Building listener</a>
						</li>
						<li >
							<a href="daemon.html" title="Building daemon">Building daemon</a>
						</li>
						<li >
							<a href="client.html" title="Building client">Building client</a>
						</li>
						<li >
							<a href="json.html" title="JSON extras">JSON extras</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Project Documentation</li>
						<li >
							<a href="../project-info.html" title="Project Information">Project Information <i class="icon-chevron-right"></i></a>
						</li>
						<li >
							<a href="../project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2015 <a href="http://wrzasq.pl/">Rafał Wrzeszcz - Wrzasq.pl</a>. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 0.0.4. </span><span class="publishDate">Last Published: 2015-08-11. </span></p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="../js/lightbox.min.js"></script>
	<script src="../js/reflow-scroll.js"></script>
	<script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>

	<script src="../js/reflow-skin.js"></script>

	</body>
</html>
