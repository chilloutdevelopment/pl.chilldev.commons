<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.1 at 2016-08-27 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20160827" />
    <meta http-equiv="Content-Language" content="en" />
    <title>ChillDev Commons JSON-RPC &#x2013; Netty I/O</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.5.min.js"></script>

                      </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>ChillDev Commons JSON-RPC</h2>
                </div>
                      </div>
        <div class="pull-right">                  <a href="http://wrzasq.pl" id="bannerRight">
                <h2><img src="http://static.wrzasq.pl/images/wrzasqpl.png" alt="Wrzasq.pl"/></h2>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
            
              
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Main</li>
                              
      <li>
  
                          <a href="https://github.com/chilloutdevelopment/pl.chilldev.commons/" class="externalLink" title="GitHub project">
          <span class="none"></span>
        GitHub project</a>
            </li>
                
      <li>
  
                          <a href="http://chilldev.pl/" class="externalLink" title="Chillout Development">
          <span class="none"></span>
        Chillout Development</a>
            </li>
                
      <li>
  
                          <a href="http://wrzasq.pl/" class="externalLink" title="Wrzasq.pl">
          <span class="none"></span>
        Wrzasq.pl</a>
            </li>
                
      <li>
  
                          <a href="https://www.facebook.com/chilldev" class="externalLink" title="ChillDev @ Facebook">
          <span class="none"></span>
        ChillDev @ Facebook</a>
            </li>
                
      <li>
  
                          <a href="https://www.facebook.com/wrzasqpl" class="externalLink" title="Wrzasq.pl @ Facebook">
          <span class="none"></span>
        Wrzasq.pl @ Facebook</a>
            </li>
                              <li class="nav-header">Parent Project</li>
                              
      <li>
  
                          <a href="../../index.html" title="ChillDev Commons">
          <span class="none"></span>
        ChillDev Commons</a>
            </li>
                              <li class="nav-header">Guide</li>
                              
      <li>
  
                          <a href="../guide/rpc.html" title="JSON-RPC - dispatcher">
          <span class="none"></span>
        JSON-RPC - dispatcher</a>
            </li>
                
      <li>
  
                          <a href="../guide/introspector.html" title="JSON-RPC - introspector">
          <span class="none"></span>
        JSON-RPC - introspector</a>
            </li>
                
      <li class="active">
  
            <a href="#"><span class="none"></span>Netty I/O</a>
          </li>
                
      <li>
  
                          <a href="../guide/listener.html" title="Building listener">
          <span class="none"></span>
        Building listener</a>
            </li>
                
      <li>
  
                          <a href="../guide/daemon.html" title="Building daemon">
          <span class="none"></span>
        Building daemon</a>
            </li>
                
      <li>
  
                          <a href="../guide/client.html" title="Building client">
          <span class="none"></span>
        Building client</a>
            </li>
                
      <li>
  
                          <a href="../guide/json.html" title="JSON extras">
          <span class="none"></span>
        JSON extras</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                      
      <li>
  
                          <a href="../project-info.html" title="Project Information">
          <span class="icon-chevron-right"></span>
        Project Information</a>
                  </li>
                                                                                                                                                                                                
      <li>
  
                          <a href="../project-reports.html" title="Project Reports">
          <span class="icon-chevron-right"></span>
        Project Reports</a>
                  </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                   <a href="http://maven.apache.org/" title="Maven" class="builtBy">
        <img class="builtBy"  alt="Apache Maven" src="http://maven.apache.org/images/logos/maven-feather.png"    />
      </a>
                                                                                                    <a href="http://chilldev.pl" title="Chillout Development" class="builtBy">
        <img class="builtBy"  alt="Chillout Development" src="http://static.chilldev.pl/images/chilldevpl.png"    />
      </a>
                                                                                                    <a href="http://wrzasq.pl" title="Wrzasq.pl" class="builtBy">
        <img class="builtBy"  alt="Wrzasq.pl" src="http://static.chilldev.pl/images/wrzasqpl.png"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <!---
# This file is part of the ChillDev-Commons.
#
# @license http://mit-license.org/ The MIT license
# @copyright 2016 © by Rafał Wrzeszcz - Wrzasq.pl.
--><h1>Netty I/O</h1>
<p><a class="externalLink" href="http://netty.io"><b>Netty</b></a> is perfect for building <b>JSON-RPC</b> services as it brings asynchronous network I/O stack without footprint of enclosing protocol (like <b>HTTP</b>) - you can use it to build plain <b>TCP</b> service. There are two classes that will help you bind your RPC <tt>Dispatcher</tt> with Netty socket. First is <tt>pl.chilldev.commons.jsonrpc.netty.DispatcherHandler</tt> which binds to Netty socket and handles requests using JSON-RPC dispatcher provided by you; second is <tt>pl.chilldev.commons.jsonrpc.netty.StringChannelInitializer</tt>, which is a simple utility class that configures the socket parameters.</p>

<div class="source">
<div class="source"><pre class="prettyprint">import io.netty.bootstrap.ServerBootstrap;
import io.netty.channel.Channel;
import io.netty.channel.ChannelOption;
import io.netty.channel.EventLoopGroup;
import io.netty.channel.nio.NioEventLoopGroup;
import io.netty.channel.socket.nio.NioServerSocketChannel;

import pl.chilldev.commons.jsonrpc.netty.DispatcherHandler;
import pl.chilldev.commons.jsonrpc.netty.StringChannelInitializer;
import pl.chilldev.commons.jsonrpc.rpc.Dispatcher;

public class NetworkService
    implements
        StringChannelInitializer.Configuration
{
    @Override
    public int getMaxPacketSize()
    {
        // 1MiB
        return 1048576;
    }

    public void start(Dispatcher&lt;YourContextType&gt; dispatcher, YourContextType context)
        throws
            Exception
    {
        // these are pure Netty thread groups
        EventLoopGroup acceptors = new NioEventLoopGroup();
        EventLoopGroup workers = new NioEventLoopGroup();

        try {
            // network service configuration
            ServerBootstrap bootstrap = new ServerBootstrap();
            bootstrap
                .group(acceptors, workers)
                .channel(NioServerSocketChannel.class)
                .option(ChannelOption.SO_REUSEADDR, true)
                .childHandler(
                    new StringChannelInitializer&lt;Channel&gt;(
                        new DispatcherHandler&lt;ContextType&gt;(this.context, this.dispatcher),
                        this
                    )
                );
            bootstrap
                .bind(this.address)
                .sync()
                .channel()
                .closeFuture()
                .sync();
        } finally {
            // close connections
            acceptors.shutdownGracefully();
            workers.shutdownGracefully();
        }
    }
}
</pre></div></div>
<p><b>Note:</b> The snippet above is the standard implementation available out of the box with <a href="./listener.html">listener</a>.</p>
<p><b>Note:</b> <tt>DispatcherHandler</tt> handles all exceptions thrown during request processing (if not reported properly as error responses) and reports them as internal error to the client to avoid listener thread to die. Returned error has error code <tt>-1</tt> (see <a href="./rpc.html">error codes</a>).</p>
<div class="section">
<h2><a name="StringChannelInitializer.Configuration"></a><tt>StringChannelInitializer.Configuration</tt></h2>
<p>The example is rather straightforward, despite some boilerplate code. But one thing may not be clear - the second parameter of <tt>StringChannelInitializer()</tt> constructor, the <tt>StringChannelInitializer.Configuration</tt> interface implementation and <tt>getMaxPacketSize()</tt> method (yes, in fact it&#x2019;s just one thing!). One of the parameters <tt>StringChannelInitializer()</tt> constructor set is maximum packet size. It does that based on configuration object passed as a thord argument, which has to implement <tt>StringChannelInitializer.Configuration</tt> interface. All you need to do is simply implement the <tt>getMaxPacketSize()</tt> that will return your desired packet size limit.</p></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                    2015&#x2013;2016
                        <a href="http://wrzasq.pl/">Rafał Wrzeszcz - Wrzasq.pl</a>.
            All rights reserved.    
                  <li id="publishDate" class="pull-right">Last Published: 2016-08-27</li>
              <li id="projectVersion" class="pull-right">
                    Version: 0.1.2
        </li>
            </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
