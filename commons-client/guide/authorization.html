<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 at 2019-03-21 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20190321" />
    <meta http-equiv="Content-Language" content="en" />
    <title>WrzasqPl Commons Client &#x2013; Usage</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
      <script type="text/javascript" src="../js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>WrzasqPl Commons Client</h2>
</div>
</div>
        <div class="pull-right"><a href="https://wrzasq.pl" id="bannerRight"><h2><img src="https://static.wrzasq.pl/images/wrzasqpl.png" alt="Wrzasq.pl"/></h2>
</a></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Main</li>
    <li><a href="https://github.com/rafalwrzeszcz-wrzasqpl/pl.wrzasq.commons/" class="externalLink" title="GitHub project"><span class="none"></span>GitHub project</a>  </li>
    <li><a href="https://wrzasq.pl/" class="externalLink" title="Wrzasq.pl"><span class="none"></span>Wrzasq.pl</a>  </li>
    <li><a href="https://www.facebook.com/wrzasqpl" class="externalLink" title="Wrzasq.pl @ Facebook"><span class="none"></span>Wrzasq.pl @ Facebook</a>  </li>
          <li class="nav-header">Parent Project</li>
    <li><a href="../../index.html" title="WrzasqPl Commons"><span class="none"></span>WrzasqPl Commons</a>  </li>
          <li class="nav-header">Guide</li>
    <li><a href="../guide/factory.html" title="Factory"><span class="none"></span>Factory</a>  </li>
    <li><a href="../guide/spring-data.html" title="Spring Data"><span class="none"></span>Spring Data</a>  </li>
    <li><a href="../guide/spring-errors.html" title="Spring Errors"><span class="none"></span>Spring Errors</a>  </li>
    <li><a href="../guide/delegate-decoder.html" title="Content-Type delegation"><span class="none"></span>Content-Type delegation</a>  </li>
    <li class="active"><a href="#"><span class="none"></span>Authorization</a>
  </li>
          <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a>  </li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="https://maven.apache.org/" title="Maven" class="builtBy"><img class="builtBy"  alt="Apache Maven" src="https://maven.apache.org/images/logos/maven-feather.png"    /></a>
<a href="https://wrzasq.pl" title="Wrzasq.pl" class="builtBy"><img class="builtBy"  alt="Wrzasq.pl" src="https://static.wrzasq.pl/images/wrzasqpl.png"    /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<!---
# This file is part of the pl.wrzasq.commons.
#
# @license http://mit-license.org/ The MIT license
# @copyright 2017, 2019 © by Rafał Wrzeszcz - Wrzasq.pl.
-->
<h1>Usage</h1>
<p>When working with micro-services having a common and scalable security layer across entire infrastructure is critical. For <b>HTTP</b> based services such security layer very often relies on <tt>Authorization</tt> layer (like <b>OAuth</b>, <b>JWT</b> and other technologies). As such security layer is often unified across your entire architecture, in some cases you may simply forward the incoming authorization string to access downstream resources. For instance if you have API gateway service in place that forwards the calls to downstream domain services it should be transparent for the client.</p>
<p><tt>pl.wrzasq.commons.client.interceptor.AuthorizationForwarder</tt> class is designed to work with <b>Spring</b> application to execute downstream calls on behalf on enduser:</p>

<div>
<div>
<pre class="source">interface UsersClient
{
    @RequestLine(&quot;GET /me&quot;)
    User getCurrentProfile();
}

Collection&lt;Consumer&lt;Feign.Builder&gt;&gt; yourConfigurators = new ArrayList&lt;&gt;();
yourConfigurators.add(
    builder -&gt; builder
        // about obtaining the bean read below
        .requestInterceptor(yourAuthorizationForwarderBean)
);

FeignClientFactory factory = new BaseFeignClientFactory(yourConfigurators);

UsersClient usersClient = factory.createClient(UsersClient.class, &quot;http://users.internal&quot;);

@Controller
public class ProfileController
{
    @Autowired
    private UsersClient usersClient;

    @RequestMapping(&quot;/profile&quot;)
    public String profile(Model model)
    {
        model.put(&quot;profile&quot;, this.usersClient.getCurrentProfile());
    }
}
</pre></div></div>

<p>Sometimes you may however want to specify custom authorization for the request, for example when you execute request on behalf of your service, not your user. If the <tt>Authorization</tt> header is already specified, it won&#x2019;t be overriden:</p>

<div>
<div>
<pre class="source">interface UsersClient
{
    // this method will use incoming header value
    @RequestLine(&quot;GET /me&quot;)
    User getCurrentProfile();

    // this method will use header value specified by parameter
    @RequestLine(&quot;GET /me&quot;)
    @Headers(&quot;Authorization: {apiKey}&quot;)
    User getApplicationProfile(@Param(&quot;apiKey&quot;) String apiKey);
}
</pre></div></div>

<div class="section">
<h2><a name="Obtaining_the_bean"></a>Obtaining the bean</h2>
<p><tt>AuthorizationForwarder</tt> is designed to work as a <b>Spring</b> <a class="externalLink" href="https://docs.spring.io/spring/docs/5.0.1.RELEASE/spring-framework-reference/core.html#beans-factory-scopes-other">request-scope bean</a>. The class is annotated so you can use component scanning to automatically instantiate it:</p>

<div>
<div>
<pre class="source">@Configuration
@ComponentScan(&quot;pl.wrzasq.commons.client&quot;)
public class FeignConfiguration
{
}
</pre></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2017&#x2013;2019
<a href="https://wrzasq.pl/">Rafał Wrzeszcz - Wrzasq.pl</a>.
All rights reserved.        <li id="publishDate" class="pull-right">Last Published: 2019-03-21</li>
          <li id="projectVersion" class="pull-right">Version: 1.0.4</li>
</p>
        </div>
        </div>
    </footer>
    </body>
</html>
