
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2015-08-11
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>ChillDev Commons Concurrent &#x2013; Message bag</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet" />
		<link href="../css/docs.css" rel="stylesheet" />
		<link href="../css/reflow-skin.css" rel="stylesheet" />

		<link href="http://yandex.st/highlightjs/7.5/styles/default.min.css" rel="stylesheet" />

		<link href="../css/lightbox.css" rel="stylesheet" />

		<link href="../css/site.css" rel="stylesheet" />
		<link href="../css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->



	</head>

	<body class="page-guide-flash-messages project-commons-concurrent" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="http://chilldev.pl"><img src="http://static.chilldev.pl/images/chilldevpl.png" alt="Chillout Development"/></a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Main <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="https://github.com/chilloutdevelopment/pl.chilldev.commons/" title="GitHub project" class="externalLink">GitHub project</a></li>
									<li ><a href="http://chilldev.pl/" title="Chillout Development" class="externalLink">Chillout Development</a></li>
									<li ><a href="http://wrzasq.pl/" title="Wrzasq.pl" class="externalLink">Wrzasq.pl</a></li>
									<li ><a href="https://www.facebook.com/chilldev" title="ChillDev @ Facebook" class="externalLink">ChillDev @ Facebook</a></li>
									<li ><a href="https://www.facebook.com/wrzasqpl" title="Wrzasq.pl @ Facebook" class="externalLink">Wrzasq.pl @ Facebook</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Parent Project <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../../index.html" title="ChillDev Commons">ChillDev Commons</a></li>
								</ul>
							</li>
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Guide <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="futures.html" title="Futures">Futures</a></li>
									<li class="active"><a href="" title="Flash messages">Flash messages</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li class="dropdown-submenu ">
										<a href="../project-info.html" title="Project Information">Project Information</a>
										<ul class="dropdown-menu">
											<li ><a href="../integration.html" title="Continuous Integration">Continuous Integration</a></li>
											<li ><a href="../dependencies.html" title="Dependencies">Dependencies</a></li>
											<li ><a href="../dependency-info.html" title="Dependency Information">Dependency Information</a></li>
											<li ><a href="../distribution-management.html" title="Distribution Management">Distribution Management</a></li>
											<li ><a href="../index.html" title="About">About</a></li>
											<li ><a href="../issue-tracking.html" title="Issue Tracking">Issue Tracking</a></li>
											<li ><a href="../license.html" title="Project License">Project License</a></li>
											<li ><a href="../plugin-management.html" title="Plugin Management">Plugin Management</a></li>
											<li ><a href="../plugins.html" title="Project Plugins">Project Plugins</a></li>
											<li ><a href="../team-list.html" title="Project Team">Project Team</a></li>
											<li ><a href="../source-repository.html" title="Source Repository">Source Repository</a></li>
											<li ><a href="../project-summary.html" title="Project Summary">Project Summary</a></li>
										</ul>
									</li>
									<li class="dropdown-submenu ">
										<a href="../project-reports.html" title="Project Reports">Project Reports</a>
										<ul class="dropdown-menu">
											<li ><a href="../checkstyle.html" title="Checkstyle">Checkstyle</a></li>
											<li ><a href="../apidocs/index.html" title="JavaDocs">JavaDocs</a></li>
											<li ><a href="../xref/index.html" title="Source Xref">Source Xref</a></li>
											<li ><a href="../xref-test/index.html" title="Test Source Xref">Test Source Xref</a></li>
											<li ><a href="../surefire-report.html" title="Surefire Report">Surefire Report</a></li>
											<li ><a href="../cobertura/index.html" title="Cobertura Test Coverage">Cobertura Test Coverage</a></li>
											<li ><a href="../findbugs.html" title="FindBugs">FindBugs</a></li>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	<div class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<div id="bannerLeft"><h1>ChillDev Commons</h1></div>
				</div>
				<div class="pull-right">
					<a href="http://wrzasq.pl" id="bannerRight"><h1><img src="http://static.wrzasq.pl/images/wrzasqpl.png" alt="Wrzasq.pl"/></h1></a>
				</div>
			</div>
		</div>
	</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span12">
			<div class="body-content">
<!-- -
# This file is part of the ChillDev-Commons.
#
# @license http://mit-license.org/ The MIT license
# @copyright 2014 © by Rafał Wrzeszcz - Wrzasq.pl. --> 
<div class="page-header">
 <h1>Message bag</h1>
</div> 
<p>Although there is nothing strictly web-related in <tt>pl.chilldev.commons.concurrent.collections.MessageBag</tt> class, it’s direct purpose is to serve as a flash messages container for web applications.</p> 
<p><tt>MessageBag</tt> is a synchronized wrapper for messages container which stores messages for one-time displaying. Messages are stored by type (currently just a string identifier) - every time you add a message it’s stored in the container until you fetch list of messages - then all of them are dropped from the container.</p> 
<p>Here is an example of how to add messages to the container:</p> 
<div class="source"> 
 <div class="source"> 
  <pre>import pl.chilldev.commons.concurrent.collections.MessageBag;

MessageBag messages = new MessageBag();
messages.addMessage(&quot;done&quot;, &quot;Connected to server.&quot;);
messages.addMessage(&quot;done&quot;, &quot;Saving list succeeded.&quot;);
messages.addMessage(&quot;error&quot;, &quot;Sending e-mail failed.&quot;);
</pre> 
 </div> 
</div> 
<p>To check if container contains any messages to display you may use <tt>hasMessages()</tt> method:</p> 
<div class="source"> 
 <div class="source"> 
  <pre>// check if there are any messages
if (messages.hasMessages()) {
    // display messages
}

// check if there are messages of particular type
if (messages.hasMessages(&quot;error&quot;)) {
    // display error messages
}
</pre> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="MessagesBag.Message">MessagesBag.Message</h2> 
 <p>Before we discuss how to display messages there is one additional thing you need to know - although you add just a simple string messages, internall they are stored as a <tt>MessageBag.Message</tt> class instances and this is what you will receive back from the container. This allows us to wrap some additional meta-data to them (for now it’s only creation date, but meta info may be extended some day).</p> 
 <p>Message class contains two methods:</p> 
 <ul> 
  <li><tt>getContent()</tt> which returns string message you added to the container,</li> 
  <li><tt>getCreatedAt()</tt> which returns time instant at which you added the message.</li> 
 </ul> 
</div> 
<div class="section"> 
 <h2 id="Displaying_messages">Displaying messages</h2> 
 <p>You have two ways for fetching the messages - by type, or all at once. You have to remember that whenever you fetch the messages from ths container, the cotnainer is cleaned afterwards (if you fetch messages by type, only given type is removed). So you should only fetch messages if you are sure you are just about to display them. For checking for messages existance you should use <tt>hasMessages()</tt> method presented above. If, for whatever reason, you already fetched messages and you know your flow will not reach displying the messages (web redirect, exception thrown) you should put messages back to the container.</p> 
 <p><i>Note:</i> Both <tt>getMessages(type)</tt> and <tt>getAllMessages()</tt> are <tt>NULL</tt>-safe, which means they always return containers (<tt>List</tt> and <tt>Map</tt> respectively), at least empty ones if there are no messages. Effectively, this means that if you are sure you are just about to display messages, you don’t need to check if there are any messages in the container (unless you want to produce some additional markup for the container etc.).</p> 
 <p>Fetching by type:</p> 
 <div class="source"> 
  <div class="source"> 
   <pre>import java.util.List;

import pl.chilldev.commons.concurrent.collections.MessageBag;

// displaying messages of given type
List&lt;MessageBag.Message&gt; firstList = messages.getMessages(&quot;done&quot;);
List&lt;MessageBag.Message&gt; secondList = messages.getMessages(&quot;done&quot;);

for (MessageBag.Message message : firstList) {
    System.out.println(&quot;SUCCESS: &quot; + message.getContent());
}

// assuming there is no un-synchronized operation between two fetched above
// secondList will always be empty
for (MessageBag.Message message : secondList) {
    System.out.println(&quot;SUCCESS: &quot; + message.getContent());
}
</pre> 
  </div> 
 </div> 
 <p>Fetching all the messages:</p> 
 <div class="source"> 
  <div class="source"> 
   <pre>import java.util.List;
import java.util.Map;

import pl.chilldev.commons.concurrent.collections.MessageBag;

// displaying messages of given type
Map&lt;String, List&lt;MessageBag.Message&gt;&gt; firstMap = messages.getAllMessages();
Map&lt;String, List&lt;MessageBag.Message&gt;&gt; secondMap = messages.getAllMessages();

for (Map.Entry&lt;String, MessageBag.Message&gt; entry : firstMap.entrySet()) {
    for (MessageBag.Message message : entry.getValue()) {
        System.out.println(&quot;[%s] %s&quot;.format(entry.getKey(), message.getContent()));
    }
}

// assuming there is no un-synchronized operation between two fetched above
// secondMap will always be empty
for (Map.Entry&lt;String, MessageBag.Message&gt; entry : secondMap.entrySet()) {
    // nothing to do here
}
</pre> 
  </div> 
 </div> 
 <p><i>Note:</i> If you fetch all messages (<tt>getAllMessages()</tt> method) don’t relay on <tt>Map.isEmpty()</tt> method! Although all message instances are removed from the container after being fetched, to save operations empty lists are not removed - they don’t disturb in anything, so they are kept internally as most likely you will use same message types all the time. Because of that, even if there are no messages within the returned map, the map itself may not be empty because of containing empty lists.</p> 
</div> 
<div class="section"> 
 <h2 id="Spring_integration">Spring integration</h2> 
 <p>To integrate <tt>MessageBag</tt> into <i>Spring</i> you just need to add service definition (you may want to add <tt>id</tt> attribute if you want to refer to it within DI):</p> 
 <div class="source"> 
  <div class="source"> 
   <pre>&lt;bean class=&quot;pl.chilldev.commons.concurrent.collections.MessageBag&quot; scope=&quot;session&quot;/&gt;
</pre> 
  </div> 
 </div> 
</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Main</li>
						<li >
							<a href="https://github.com/chilloutdevelopment/pl.chilldev.commons/" title="GitHub project" class="externalLink">GitHub project</a>
						</li>
						<li >
							<a href="http://chilldev.pl/" title="Chillout Development" class="externalLink">Chillout Development</a>
						</li>
						<li >
							<a href="http://wrzasq.pl/" title="Wrzasq.pl" class="externalLink">Wrzasq.pl</a>
						</li>
						<li >
							<a href="https://www.facebook.com/chilldev" title="ChillDev @ Facebook" class="externalLink">ChillDev @ Facebook</a>
						</li>
						<li >
							<a href="https://www.facebook.com/wrzasqpl" title="Wrzasq.pl @ Facebook" class="externalLink">Wrzasq.pl @ Facebook</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Parent Project</li>
						<li >
							<a href="../../index.html" title="ChillDev Commons">ChillDev Commons</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Guide</li>
						<li >
							<a href="futures.html" title="Futures">Futures</a>
						</li>
						<li class="active">
							<a href="#" title="Flash messages">Flash messages</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Project Documentation</li>
						<li >
							<a href="../project-info.html" title="Project Information">Project Information <i class="icon-chevron-right"></i></a>
						</li>
						<li >
							<a href="../project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2014-2015 <a href="http://wrzasq.pl/">Rafał Wrzeszcz - Wrzasq.pl</a>. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 0.0.4. </span><span class="publishDate">Last Published: 2015-08-11. </span></p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="../js/lightbox.min.js"></script>
	<script src="../js/reflow-scroll.js"></script>
	<script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>

	<script src="../js/reflow-skin.js"></script>

	</body>
</html>
